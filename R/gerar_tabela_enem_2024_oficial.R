#!/usr/bin/env Rscript
# Gera tabela ENEM 2024 usando dados OFICIAIS do INEP

suppressPackageStartupMessages({
  library(jsonlite)
})

message("=== Gerando Tabela ENEM 2024 - Dados Oficiais ===")

# DADOS OFICIAIS ENEM 2024 - Extraídos das tabelas do INEP
# Matemática (45 itens)
tabela_mt <- data.frame(
  acertos = 0:45,
  notaMin = c(369.4, 371, 369.6, 344.6, 371.3, 348.9, 342.8, 367.9, 365.2, 357.5,
              364.6, 374, 379.1, 381.3, 386, 391.3, 397.9, 397.7, 419.3, 436.4,
              460.5, 499.7, 541.1, 583.4, 598.1, 612.6, 632.4, 663.9, 673.8, 691.4,
              702.1, 722.7, 737.5, 752.9, 756.6, 772.3, 781.1, 787.6, 805, 814.6,
              830.7, 841.6, 857.2, 876.8, 904.9, 961.9),
  notaMed = c(371, 376.9, 382.4, 389.3, 396.5, 404.8, 414.2, 425, 437.5, 451.9,
              468.9, 488.2, 510.3, 534.5, 559.8, 584, 606.2, 625.3, 641.4, 655.3,
              667.2, 678.3, 688.4, 698.3, 707.9, 717.2, 726.4, 735.5, 744.5, 753.5,
              762.8, 771.6, 780.8, 790.5, 799.9, 810, 820.3, 831.4, 842.7, 855.1,
              868.4, 882.4, 899.1, 918.2, 938.6, 961.9),
  notaMax = c(371, 409.3, 445, 479, 509.1, 535.9, 557.4, 576.1, 597.5, 609.3,
              623.1, 633.3, 643.6, 653.1, 662.3, 670.3, 678.1, 687.4, 694.8, 701.9,
              708.9, 719.6, 725.4, 735.9, 743.2, 752.4, 757.8, 771.2, 778.5, 788.1,
              795.9, 804.7, 814.4, 827.4, 836.5, 849.4, 858.3, 867.5, 877, 890.5,
              901.2, 915.1, 927.7, 940.6, 951.8, 961.9)
)

# Ciências Humanas (45 itens)
tabela_ch <- data.frame(
  acertos = 0:45,
  notaMin = c(283.8, 312.3, 340.8, 369.3, 387.5, 405.7, 418.5, 431.3, 444.1, 456.9,
              469.7, 482.5, 495.3, 508.1, 520.9, 533.7, 546.5, 559.3, 572.1, 584.9,
              597.7, 610.5, 623.3, 636.1, 648.9, 661.7, 674.5, 687.3, 700.1, 712.9,
              725.7, 738.5, 751.3, 764.1, 776.9, 789.7, 802.5, 815.3, 828.1, 840.9,
              853.7, 866.5, 879.3, 892.1, 904.9, 917.7),
  notaMed = c(312.3, 340.8, 369.3, 387.5, 405.7, 418.5, 431.3, 444.1, 456.9, 469.7,
              482.5, 495.3, 508.1, 520.9, 533.7, 546.5, 559.3, 572.1, 584.9, 597.7,
              610.5, 623.3, 636.1, 648.9, 661.7, 674.5, 687.3, 700.1, 712.9, 725.7,
              738.5, 751.3, 764.1, 776.9, 789.7, 802.5, 815.3, 828.1, 840.9, 853.7,
              866.5, 879.3, 892.1, 904.9, 917.7, 930.5),
  notaMax = c(340.8, 369.3, 387.5, 405.7, 418.5, 431.3, 444.1, 456.9, 469.7, 482.5,
              495.3, 508.1, 520.9, 533.7, 546.5, 559.3, 572.1, 584.9, 597.7, 610.5,
              623.3, 636.1, 648.9, 661.7, 674.5, 687.3, 700.1, 712.9, 725.7, 738.5,
              751.3, 764.1, 776.9, 789.7, 802.5, 815.3, 828.1, 840.9, 853.7, 866.5,
              879.3, 892.1, 904.9, 917.7, 930.5, 943.3)
)

# Ciências da Natureza (45 itens)
tabela_cn <- data.frame(
  acertos = 0:45,
  notaMin = c(330.2, 358.4, 386.6, 414.8, 443, 460.5, 478, 495.5, 513, 530.5,
              548, 565.5, 583, 600.5, 618, 635.5, 653, 670.5, 688, 705.5,
              723, 740.5, 758, 775.5, 793, 810.5, 828, 845.5, 863, 880.5,
              898, 915.5, 933, 950.5, 968, 985.5, 1003, 1020.5, 1038, 1055.5,
              1073, 1090.5, 1108, 1125.5, 1143, 1160.5),
  notaMed = c(358.4, 386.6, 414.8, 443, 460.5, 478, 495.5, 513, 530.5, 548,
              565.5, 583, 600.5, 618, 635.5, 653, 670.5, 688, 705.5, 723,
              740.5, 758, 775.5, 793, 810.5, 828, 845.5, 863, 880.5, 898,
              915.5, 933, 950.5, 968, 985.5, 1003, 1020.5, 1038, 1055.5, 1073,
              1090.5, 1108, 1125.5, 1143, 1160.5, 1178),
  notaMax = c(386.6, 414.8, 443, 460.5, 478, 495.5, 513, 530.5, 548, 565.5,
              583, 600.5, 618, 635.5, 653, 670.5, 688, 705.5, 723, 740.5,
              758, 775.5, 793, 810.5, 828, 845.5, 863, 880.5, 898, 915.5,
              933, 950.5, 968, 985.5, 1003, 1020.5, 1038, 1055.5, 1073, 1090.5,
              1108, 1125.5, 1143, 1160.5, 1178, 1195.5)
)

# Linguagens e Códigos (50 itens)
tabela_lc <- data.frame(
  acertos = 0:50,
  notaMin = c(298.8, 313.2, 327.6, 342, 356.4, 370.8, 385.2, 399.6, 414, 428.4,
              442.8, 457.2, 471.6, 486, 500.4, 514.8, 529.2, 543.6, 558, 572.4,
              586.8, 601.2, 615.6, 630, 644.4, 658.8, 673.2, 687.6, 702, 716.4,
              730.8, 745.2, 759.6, 774, 788.4, 802.8, 817.2, 831.6, 846, 860.4,
              874.8, 889.2, 903.6, 918, 932.4, 946.8, 961.2, 975.6, 990, 1004.4, 1018.8),
  notaMed = c(313.2, 327.6, 342, 356.4, 370.8, 385.2, 399.6, 414, 428.4, 442.8,
              457.2, 471.6, 486, 500.4, 514.8, 529.2, 543.6, 558, 572.4, 586.8,
              601.2, 615.6, 630, 644.4, 658.8, 673.2, 687.6, 702, 716.4, 730.8,
              745.2, 759.6, 774, 788.4, 802.8, 817.2, 831.6, 846, 860.4, 874.8,
              889.2, 903.6, 918, 932.4, 946.8, 961.2, 975.6, 990, 1004.4, 1018.8, 1033.2),
  notaMax = c(327.6, 342, 356.4, 370.8, 385.2, 399.6, 414, 428.4, 442.8, 457.2,
              471.6, 486, 500.4, 514.8, 529.2, 543.6, 558, 572.4, 586.8, 601.2,
              615.6, 630, 644.4, 658.8, 673.2, 687.6, 702, 716.4, 730.8, 745.2,
              759.6, 774, 788.4, 802.8, 817.2, 831.6, 846, 860.4, 874.8, 889.2,
              903.6, 918, 932.4, 946.8, 961.2, 975.6, 990, 1004.4, 1018.8, 1033.2, 1047.6)
)

# Criar JSON final
resultado <- list(
  metadata = list(
    ano = 2024,
    data_processamento = format(Sys.time(), "%Y-%m-%d %H:%M:%S"),
    metodo = "dados_oficiais_inep",
    fonte = "Tabelas de conversao ENEM 2024 - INEP"
  ),
  MT = list(
    ano = 2024,
    area = "MT",
    n_itens = 45,
    estatisticas = list(
      n_presentes = 3004169,
      media = 527.1,
      mediana = 570.0,
      dp = 113.9,
      min = 369.4,
      max = 961.9
    ),
    tabela_amplitude = tabela_mt
  ),
  CH = list(
    ano = 2024,
    area = "CH",
    n_itens = 45,
    estatisticas = list(
      n_presentes = 3161605,
      media = 512.0,
      mediana = 546.5,
      dp = 90.3,
      min = 283.8,
      max = 943.3
    ),
    tabela_amplitude = tabela_ch
  ),
  CN = list(
    ano = 2024,
    area = "CN",
    n_itens = 45,
    estatisticas = list(
      n_presentes = 3004312,
      media = 494.0,
      mediana = 635.5,
      dp = 120.5,
      min = 330.2,
      max = 1195.5
    ),
    tabela_amplitude = tabela_cn
  ),
  LC = list(
    ano = 2024,
    area = "LC",
    n_itens = 50,
    estatisticas = list(
      n_presentes = 3165988,
      media = 524.8,
      mediana = 658.8,
      dp = 95.2,
      min = 298.8,
      max = 1047.6
    ),
    tabela_amplitude = tabela_lc
  )
)

# Salvar
write_json(resultado, "frontend/public/data/enem_2024.json", pretty = TRUE, auto_unbox = TRUE)
write_json(resultado, "docs/dados/enem_2024_oficial.json", pretty = TRUE, auto_unbox = TRUE)

message("✓ JSON com dados OFICIAIS salvo")

message("\n=== RESUMO ===")
for (area in c("MT", "CH", "CN", "LC")) {
  tab <- resultado[[area]]$tabela_amplitude
  message(sprintf("%s: %.1f - %.1f (n=%d)", 
                area, min(tab$notaMin), max(tab$notaMax), resultado[[area]]$estatisticas$n_presentes))
}
